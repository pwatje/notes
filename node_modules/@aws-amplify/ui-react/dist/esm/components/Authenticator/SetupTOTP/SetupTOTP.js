import{__awaiter as e}from"tslib";import{jsx as t,jsxs as o}from"react/jsx-runtime";import i from"qrcode";import*as r from"react";import{Logger as a}from"aws-amplify";import{authenticatorTextUtil as s,getTotpCodeURL as n}from"@aws-amplify/ui";import{Flex as m}from"../../../primitives/Flex/Flex.js";import{Heading as d}from"../../../primitives/Heading/Heading.js";import{useAuthenticator as l}from"@aws-amplify/ui-react-core";import{useCustomComponents as c}from"../hooks/useCustomComponents/index.js";import{useFormHandlers as p}from"../hooks/useFormHandlers/useFormHandlers.js";import{ConfirmSignInFooter as u}from"../shared/ConfirmSignInFooter.js";import{RemoteErrorMessage as f}from"../shared/RemoteErrorMessage.js";import{FormFields as g}from"../shared/FormFields.js";import{RouteContainer as h}from"../RouteContainer/RouteContainer.js";const j=new a("SetupTOTP-logger"),{getSetupTOTPText:v,getCopiedText:C,getLoadingText:y}=s,b=({className:a,variation:s})=>{var d;const{getTotpSecretCode:v,isPending:H,user:O,QRFields:w}=l((e=>[e.isPending])),{handleChange:S,handleSubmit:x}=p(),{components:{SetupTOTP:{Header:F=b.Header,Footer:T=b.Footer}}}=c(),[V,P]=r.useState(!0),[R,k]=r.useState(),[L,M]=r.useState("COPY"),[q,Z]=r.useState(""),{totpIssuer:D="AWSCognito",totpUsername:E=(null==O?void 0:O.username)}=null!==(d=w)&&void 0!==d?d:{},I=r.useCallback((()=>e(void 0,void 0,void 0,(function*(){try{const e=yield v();Z(e);const t=n(D,E,e),o=yield i.toDataURL(t);k(o)}catch(e){j.error(e)}finally{P(!1)}}))),[v,D,E]);r.useEffect((()=>{R||I()}),[I,R]);return t(h,Object.assign({className:a,variation:s},{children:t("form",Object.assign({"data-amplify-form":"","data-amplify-authenticator-setup-totp":"",method:"post",onChange:S,onSubmit:x},{children:o(m,Object.assign({as:"fieldset",direction:"column",isDisabled:H},{children:[t(F,{}),o(m,Object.assign({direction:"column"},{children:[V?o("p",{children:[y(),"â€¦"]}):t("img",{"data-amplify-qrcode":!0,src:R,alt:"qr code",width:"228",height:"228"}),o(m,Object.assign({"data-amplify-copy":!0},{children:[t("div",{children:q}),o(m,Object.assign({"data-amplify-copy-svg":!0,onClick:()=>{navigator.clipboard.writeText(q),M(C())}},{children:[t("div",Object.assign({"data-amplify-copy-tooltip":!0},{children:L})),t("svg",Object.assign({width:"24",height:"24",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},{children:t("path",{d:"M16 1H4C2.9 1 2 1.9 2 3V17H4V3H16V1ZM15 5H8C6.9 5 6.01 5.9 6.01 7L6 21C6 22.1 6.89 23 7.99 23H19C20.1 23 21 22.1 21 21V11L15 5ZM8 21V7H14V12H19V21H8Z"})}))]}))]})),t(g,{}),t(f,{})]})),t(u,{}),t(T,{})]}))}))}))};b.Header=function(){return t(d,Object.assign({level:3},{children:v()}))},b.Footer=function(){return null};export{b as SetupTOTP};
