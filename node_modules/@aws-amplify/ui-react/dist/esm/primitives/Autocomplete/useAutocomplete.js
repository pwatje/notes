import*as e from"react";import{ARROW_UP as t,ARROW_DOWN as n,ENTER_KEY as o,ESCAPE_KEY as l}from"../shared/constants.js";import{isFunction as s,strHasLength as i}from"../shared/utils.js";import{useStableId as c}from"../utils/useStableId.js";const a=new Set([n,t,o,l]),u=({defaultValue:u="",value:r,options:d,optionFilter:m,onBlur:f,onChange:h,onClear:p,onClick:g,onSelect:b,onSubmit:C})=>{const I=void 0!==r,[v,k]=e.useState(u),w=I?r:v,[O,B]=e.useState(!1),[E,y]=e.useState(null),S=s(m),T=e.useMemo((()=>{const e=S?e=>m(e,w):e=>{const{label:t}=e;return null==t?void 0:t.toLocaleLowerCase().includes(null==w?void 0:w.toLocaleLowerCase())};return(null==d?void 0:d.filter(e))||[]}),[w,m,S,d]),H=c(),L=c(),M=c(),V=c(),j=T.findIndex((e=>e===E)),x=(null==E?void 0:E.id)||(-1!==j?`${V}-option-${j}`:void 0),D=e.useCallback((e=>{B(!1),y(null),s(f)&&f(e)}),[f]),F=e.useCallback((e=>{y(null),B(!0),I||k(e.target.value),s(h)&&h(e)}),[I,h]),R=e.useCallback((()=>{I||k(""),s(p)&&p()}),[I,p]),$=e.useCallback((e=>{B(!0),s(g)&&g(e)}),[g]);return e.useEffect((()=>{const e=document.getElementById(H),t=document.getElementById(M);if(t&&O&&e){const{bottom:n}=t.getBoundingClientRect(),{offsetParent:o,offsetTop:l}=e;o===document.body&&n>document.documentElement.clientHeight&&window.scrollTo({top:Math.min(n-document.documentElement.clientHeight+window.scrollY+20,l),behavior:"smooth"})}}),[H,O,M]),e.useEffect((()=>{const e=document.getElementById(L),t=i(x)?document.getElementById(x):null;if(t&&e){const{scrollTop:n,clientHeight:o}=e,{offsetHeight:l,offsetTop:s}=t,{top:i,bottom:c}=t.getBoundingClientRect();n>s&&(e.scrollTop=s),n+o<s+l&&(e.scrollTop=s+l-o),(i<0||c>document.documentElement.clientHeight)&&t.scrollIntoView({behavior:"smooth",block:"nearest"})}}),[x,L]),{activeOptionId:x,autocompleteId:H,composedValue:w,filteredOptions:T,handleOnBlur:D,handleOnClear:R,handleOnClick:$,handleOnChange:F,handleOnKeyDown:e=>{const{key:i}=e;if(a.has(i))switch(e.preventDefault(),i){case l:O?(B(!1),y(null)):R();break;case o:if(E){const{label:e}=E;I||k(e),s(b)&&b(E)}else s(C)&&C(w);B(!1),y(null);break;case n:{if(T.length<=0)return;B(!0);const e=j>=T.length-1?0:j+1;y(T[e]);break}case t:{if(T.length<=0)return;B(!0);const e=j<=0?T.length-1:j-1;y(T[e])}}},isControlled:I,isCustomFiltering:S,isMenuOpen:O,listboxId:L,menuId:M,optionBaseId:V,setActiveOption:y,setIsMenuOpen:B,setInternalValue:k}};export{u as useAutocomplete};
